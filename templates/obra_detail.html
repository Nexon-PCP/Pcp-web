{% extends "base.html" %}
{% block content %}

<div class="card">
  <div class="row" style="justify-content:space-between;align-items:center">
    <h2>{{ obra.codigo }} - {{ obra.nome }}</h2>
    <a href="{{ url_for('obras') }}"><button type="button">‚Üê Voltar</button></a>
  </div>
</div>

<!-- Informa√ß√µes da Obra -->
<div class="card">
  <h3>üìã Informa√ß√µes da Obra</h3>
  <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
    <div>
      <label style="font-weight: bold; color: #666;">C√≥digo</label>
      <p style="margin: 5px 0; font-size: 16px;">{{ obra.codigo }}</p>
    </div>
    <div>
      <label style="font-weight: bold; color: #666;">Nome</label>
      <p style="margin: 5px 0; font-size: 16px;">{{ obra.nome }}</p>
    </div>
    <div>
      <label style="font-weight: bold; color: #666;">Cliente</label>
      <p style="margin: 5px 0; font-size: 16px;">{{ obra.cliente or "-" }}</p>
    </div>
    <div>
      <label style="font-weight: bold; color: #666;">Status</label>
      <p style="margin: 5px 0; font-size: 16px;"><span class="badge">{{ obra.status }}</span></p>
    </div>
  </div>
</div>

<!-- Editar Datas -->
<div class="card">
  <h3 style="color: #d97706;">üîß Corte / Dobra</h3>
  <form method="post" action="{{ url_for('obra_atualizar_datas', obra_id=obra.id) }}" style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px;">
    
    <div>
      <label style="font-weight: bold; color: #666;">Data de In√≠cio - Corte/Dobra</label>
      <input type="date" name="corte_dobra_inicio" value="{{ obra.corte_dobra_inicio.strftime('%Y-%m-%d') if obra.corte_dobra_inicio else '' }}" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; margin-top: 5px;">
    </div>

    <div>
      <label style="font-weight: bold; color: #666;">Data de Fim - Corte/Dobra</label>
      <input type="date" name="corte_dobra_fim" value="{{ obra.corte_dobra_fim.strftime('%Y-%m-%d') if obra.corte_dobra_fim else '' }}" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; margin-top: 5px;">
    </div>

    <h3 style="color: #059669; grid-column: 1 / -1; margin-top: 20px;">‚öôÔ∏è Montagem Eletromecanica</h3>

    <div>
      <label style="font-weight: bold; color: #666;">Data de In√≠cio - Montagem Eletromecanica</label>
      <input type="date" name="montagem_eletro_inicio" value="{{ obra.montagem_eletro_inicio.strftime('%Y-%m-%d') if obra.montagem_eletro_inicio else '' }}" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; margin-top: 5px;">
    </div>

    <div>
      <label style="font-weight: bold; color: #666;">Data de Fim - Montagem Eletromecanica</label>
      <input type="date" name="montagem_eletro_fim" value="{{ obra.montagem_eletro_fim.strftime('%Y-%m-%d') if obra.montagem_eletro_fim else '' }}" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; margin-top: 5px;">
    </div>

    <div style="grid-column: 1 / -1; margin-top: 20px;">
      <button type="submit" style="background: #3b82f6; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; font-size: 16px; font-weight: bold;">üíæ Salvar Datas</button>
    </div>
  </form>
</div>

<!-- Produtos -->
<div class="card">
  <h3>üì¶ Produtos</h3>
  
  {% if obra.produtos and (obra.produtos|length > 0) %}
    <table style="width: 100%; border-collapse: collapse; margin-bottom: 20px;">
      <thead>
        <tr style="background: #f0f0f0;">
          <th style="padding: 10px; text-align: left; border-bottom: 2px solid #ddd;">Produto</th>
          <th style="padding: 10px; text-align: center; border-bottom: 2px solid #ddd;">Quantidade</th>
          <th style="padding: 10px; text-align: center; border-bottom: 2px solid #ddd; width: 100px;">A√ß√£o</th>
        </tr>
      </thead>
      <tbody>
        {% for item in obra.produtos %}
          <tr style="border-bottom: 1px solid #eee;">
            <td style="padding: 10px;">{{ item.produto.nome }}</td>
            <td style="padding: 10px; text-align: center;">{{ item.quantidade }}</td>
            <td style="padding: 10px; text-align: center;">
              <form method="post" action="{{ url_for('obra_produto_remover', obra_id=obra.id, produto_id=item.produto_id) }}" style="display: inline;" onsubmit="return confirm('Tem certeza que deseja remover este produto?');">
                <button type="submit" style="background: #dc3545; color: white; padding: 5px 10px; border: none; border-radius: 4px; cursor: pointer; font-size: 12px;">Remover</button>
              </form>
            </td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  {% else %}
    <p style="color: #999; text-align: center; padding: 20px;">Nenhum produto cadastrado nesta obra.</p>
  {% endif %}

  <h4 style="margin-top: 20px; color: #333;">Adicionar Produto</h4>
  <form method="post" action="{{ url_for('obra_produto_adicionar', obra_id=obra.id) }}" style="display: grid; grid-template-columns: 1fr 100px 100px; gap: 10px; align-items: end;">
    <div>
      <label style="font-weight: bold; color: #666;">Produto</label>
      <select name="produto_id" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; margin-top: 5px;">
        <option value="">-- Selecione --</option>
        {% for p in produtos %}
          <option value="{{ p.id }}">{{ p.nome }}</option>
        {% endfor %}
      </select>
    </div>
    <div>
      <label style="font-weight: bold; color: #666;">Quantidade</label>
      <input type="number" name="quantidade" value="1" min="1" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; margin-top: 5px;">
    </div>
    <button type="submit" style="background: #28a745; color: white; padding: 8px 16px; border: none; border-radius: 4px; cursor: pointer; font-weight: bold;">Adicionar</button>
  </form>
</div>

<!-- A√ß√µes -->
<div class="card" style="background: #fff5f5; border-left: 4px solid #dc3545;">
  <h3 style="color: #dc3545;">‚ö†Ô∏è Zona de Perigo</h3>
  <form method="post" action="{{ url_for('obra_excluir', obra_id=obra.id) }}" style="display: inline;" onsubmit="return confirm('ATEN√á√ÉO: Tem certeza que deseja EXCLUIR esta obra? Esta a√ß√£o n√£o pode ser desfeita!');">
    <button type="submit" style="background: #dc3545; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; font-weight: bold;">üóëÔ∏è Excluir Obra</button>
  </form>
</div>

<style>
  input[type="date"],
  select {
    box-sizing: border-box;
  }

  input[type="date"]:focus,
  select:focus {
    outline: none;
    border-color: #3b82f6;
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
  }

  .badge {
    display: inline-block;
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 12px;
    font-weight: bold;
    background: #e0e0e0;
    color: #333;
  }
</style>

{% endblock %}
