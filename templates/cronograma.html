{% extends "base.html" %}
{% block content %}

<div class="card">
  <h2>Cronograma</h2>

  <form method="get" action="{{ url_for('cronograma') }}" class="row" style="gap:10px;align-items:end">
    <div>
      <label>Obra</label><br>
      <select name="obra_id" required>
        <option value="">-- selecione --</option>
        {% for o in obras %}
          <option value="{{ o.id }}" {% if obra_sel and o.id == obra_sel.id %}selected{% endif %}>
            {{ o.codigo }} - {{ o.nome }}
          </option>
        {% endfor %}
      </select>
    </div>

    <button type="submit">Carregar</button>
  </form>
</div>

{% if obra_sel %}
  <div class="card">
    <h3>Nova Atividade ({{ obra_sel.codigo }} - {{ obra_sel.nome }})</h3>

    <form method="post" action="{{ url_for('cronograma_novo') }}" class="row" style="gap:10px;flex-wrap:wrap">
      <input type="hidden" name="obra_id" value="{{ obra_sel.id }}">

      <div style="min-width:260px">
        <label>Título</label><br>
        <input name="titulo" required style="width:100%">
      </div>

      <div style="min-width:220px">
        <label>Responsável</label><br>
        <input name="responsavel" style="width:100%">
      </div>

      <div>
        <label>Início Prev.</label><br>
        <input type="date" name="inicio_prev">
      </div>

      <div>
        <label>Fim Prev.</label><br>
        <input type="date" name="fim_prev">
      </div>

      <button type="submit">Salvar</button>
    </form>
  </div>

  <div class="card">
    <h3>Atividades</h3>

    <table>
      <thead>
        <tr>
          <th>Título</th>
          <th>Responsável</th>
          <th>Início Prev.</th>
          <th>Fim Prev.</th>
          <th>Status</th>
          <th>Obs</th>
        </tr>
      </thead>
      <tbody>
        {% for it in itens %}
          <tr>
            <td>{{ it.titulo }}</td>
            <td>{{ it.responsavel or "-" }}</td>
            <td>{{ it.inicio_prev.strftime("%d/%m/%Y") if it.inicio_prev else "-" }}</td>
            <td>{{ it.fim_prev.strftime("%d/%m/%Y") if it.fim_prev else "-" }}</td>
            <td><span class="badge">{{ it.status }}</span></td>
            <td>{{ it.obs or "" }}</td>
          </tr>
        {% else %}
          <tr><td colspan="6" class="muted">Nenhuma atividade cadastrada.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
{% endif %}

{% endblock %}
